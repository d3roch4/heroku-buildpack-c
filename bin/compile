#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e
set -o pipefail

BUILD_DIR=$1
CACHE_DIR=$2

#echo "instaling cmake"
#wget https://github.com/Munett/cmake-binary/raw/master/cmake.tar.gz -O cmake.tgz
#mkdir -p /app/vendor/cmake
#tar xzvf cmake.tgz -C /app/vendor/cmake

echo "-----> Configuring CMake"
cd $BUILD_DIR 
mkdir build
mkdir -p $BUILD_DIR/usr/
cd build 
cmake -DBOOST_LIBRARYDIR=.apt/usr/lib/x86_64-linux-gnu/ -DCMAKE_INSTALL_PREFIX:PATH=$BUILD_DIR/usr $BUILD_DIR 

# make
echo "-----> Compiling with Make"
make

echo "-----> Instaling"
mkdir -p $BUILD_DIR/usr
make install
cd ..
rm -rf build
rm -rf $BUILD_DIR/usr/include $BUILD_DIR/usr/*/*.a $BUILD_DIR/usr/lib/cmake $BUILD_DIR/usr/lib/pkgconfig
echo "-----> Compilation finish"
